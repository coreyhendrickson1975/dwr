---
const frames = Array.from({ length: 12 }, (_, i) => ({
  src: `/images/DWR_${String(i + 1).padStart(2, '0')}.jpg`,
  alt: 'Frame grab from The Distance We Run',
  caption: '',
}));
---

<section class="py-24 md:py-32 px-6">
  <div class="max-w-6xl mx-auto">
    <div class="text-center mb-16">
      <p class="text-xs tracking-[0.3em] uppercase text-primary mb-4 font-sans">
        Frame Grabs
      </p>
      <h2 class="text-3xl md:text-4xl font-serif text-foreground">
        Gallery
      </h2>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      {frames.map((frame) => (
        <button
          type="button"
          data-gallery-trigger
          data-src={frame.src}
          data-alt={frame.alt}
          data-caption={frame.caption}
          class="group relative aspect-video overflow-hidden rounded-sm cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary"
        >
          <img
            src={frame.src}
            alt={frame.alt}
            class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
            loading="lazy"
          />
          <div class="absolute inset-0 bg-background/0 group-hover:bg-background/40 transition-colors duration-300"></div>
          <div class="absolute bottom-0 left-0 right-0 p-4 translate-y-full group-hover:translate-y-0 transition-transform duration-300">
            <p class="text-sm text-foreground font-sans">
              {frame.caption}
            </p>
          </div>
        </button>
      ))}
    </div>

    <!-- Lightbox Modal -->
    <div
      id="gallery-modal"
      class="fixed inset-0 z-50 hidden items-center justify-center bg-background/80 backdrop-blur-sm p-4"
    >
      <div class="relative max-w-4xl w-full bg-background border border-border rounded-sm overflow-hidden">
        <button
          id="gallery-close"
          type="button"
          class="absolute top-3 right-3 z-10 w-8 h-8 flex items-center justify-center text-muted-foreground hover:text-foreground transition-colors rounded-sm bg-background/80"
          aria-label="Close gallery"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
        </button>
        <div class="aspect-video">
          <img
            id="gallery-image"
            src=""
            alt=""
            class="w-full h-full object-cover"
          />
        </div>
        <div class="p-4">
          <p id="gallery-caption" class="text-sm text-muted-foreground font-sans"></p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  const modal = document.getElementById('gallery-modal');
  const modalImage = document.getElementById('gallery-image') as HTMLImageElement;
  const modalCaption = document.getElementById('gallery-caption');
  const closeBtn = document.getElementById('gallery-close');
  const triggers = document.querySelectorAll('[data-gallery-trigger]');

  triggers.forEach((trigger) => {
    trigger.addEventListener('click', () => {
      const src = trigger.getAttribute('data-src') || '';
      const alt = trigger.getAttribute('data-alt') || '';
      const caption = trigger.getAttribute('data-caption') || '';

      if (modalImage && modalCaption && modal) {
        modalImage.src = src;
        modalImage.alt = alt;
        modalCaption.textContent = caption;
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
    });
  });

  closeBtn?.addEventListener('click', () => {
    modal?.classList.add('hidden');
    modal?.classList.remove('flex');
  });

  modal?.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
  });
</script>
